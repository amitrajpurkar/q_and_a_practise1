{% extends "base.html" %}

{% block title %}Q&A Practice - Select Topic & Difficulty{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Hero Section -->
    <div class="text-center mb-12">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-primary-100 rounded-full mb-4">
            <svg class="h-8 w-8 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
        </div>
        <h1 class="text-4xl font-bold text-gray-900 mb-4">
            Welcome to Q&A Practice
        </h1>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">
            Master Physics, Chemistry, and Math through interactive practice sessions. 
            Choose your topic and difficulty level to begin your learning journey.
        </p>
    </div>

    <!-- Selection Form -->
    <div class="bg-white rounded-xl shadow-lg p-8">
        <form id="session-form" onsubmit="return createSession(event);" hx-target="#form-result" hx-swap="innerHTML">
            <!-- Topic Selection -->
            <div class="mb-8">
                <h2 class="text-2xl font-semibold text-gray-900 mb-6 flex items-center">
                    <svg class="h-6 w-6 mr-2 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    Select Topic
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="topic-selection">
                    <!-- Physics Topic -->
                    <label class="topic-card relative cursor-pointer rounded-lg border-2 border-gray-200 p-6 hover:border-primary-300 transition-all duration-200 group">
                        <input type="radio" name="topic" value="Physics" class="sr-only peer" required>
                        <div class="flex flex-col items-center text-center">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-3 group-hover:bg-blue-200 transition-colors">
                                <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Physics</h3>
                            <p class="text-sm text-gray-600 mb-3">Forces, motion, energy, waves, and more</p>
                            <div class="topic-stats text-xs text-gray-500">
                                <span class="question-count">Loading...</span> questions
                            </div>
                        </div>
                        <div class="absolute top-2 right-2">
                            <svg class="h-5 w-5 text-primary-600 opacity-0 peer-checked:opacity-100 transition-opacity" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </label>

                    <!-- Chemistry Topic -->
                    <label class="topic-card relative cursor-pointer rounded-lg border-2 border-gray-200 p-6 hover:border-primary-300 transition-all duration-200 group">
                        <input type="radio" name="topic" value="Chemistry" class="sr-only peer" required>
                        <div class="flex flex-col items-center text-center">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mb-3 group-hover:bg-green-200 transition-colors">
                                <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Chemistry</h3>
                            <p class="text-sm text-gray-600 mb-3">Elements, reactions, compounds, solutions</p>
                            <div class="topic-stats text-xs text-gray-500">
                                <span class="question-count">Loading...</span> questions
                            </div>
                        </div>
                        <div class="absolute top-2 right-2">
                            <svg class="h-5 w-5 text-primary-600 opacity-0 peer-checked:opacity-100 transition-opacity" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </label>

                    <!-- Math Topic -->
                    <label class="topic-card relative cursor-pointer rounded-lg border-2 border-gray-200 p-6 hover:border-primary-300 transition-all duration-200 group">
                        <input type="radio" name="topic" value="Math" class="sr-only peer" required>
                        <div class="flex flex-col items-center text-center">
                            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mb-3 group-hover:bg-purple-200 transition-colors">
                                <svg class="h-6 w-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Math</h3>
                            <p class="text-sm text-gray-600 mb-3">Algebra, geometry, calculus, statistics</p>
                            <div class="topic-stats text-xs text-gray-500">
                                <span class="question-count">Loading...</span> questions
                            </div>
                        </div>
                        <div class="absolute top-2 right-2">
                            <svg class="h-5 w-5 text-primary-600 opacity-0 peer-checked:opacity-100 transition-opacity" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Difficulty Selection -->
            <div class="mb-8">
                <h2 class="text-2xl font-semibold text-gray-900 mb-6 flex items-center">
                    <svg class="h-6 w-6 mr-2 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    Select Difficulty
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="difficulty-selection">
                    <!-- Easy Difficulty -->
                    <label class="difficulty-card relative cursor-pointer rounded-lg border-2 border-gray-200 p-6 hover:border-green-300 transition-all duration-200 group">
                        <input type="radio" name="difficulty" value="Easy" class="sr-only peer" required>
                        <div class="flex flex-col items-center text-center">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mb-3 group-hover:bg-green-200 transition-colors">
                                <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Easy</h3>
                            <p class="text-sm text-gray-600 mb-3">Basic concepts and straightforward problems</p>
                            <div class="difficulty-stats text-xs text-gray-500">
                                <span class="question-count">Loading...</span> questions
                            </div>
                        </div>
                        <div class="absolute top-2 right-2">
                            <svg class="h-5 w-5 text-green-600 opacity-0 peer-checked:opacity-100 transition-opacity" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </label>

                    <!-- Medium Difficulty -->
                    <label class="difficulty-card relative cursor-pointer rounded-lg border-2 border-gray-200 p-6 hover:border-yellow-300 transition-all duration-200 group">
                        <input type="radio" name="difficulty" value="Medium" class="sr-only peer" required>
                        <div class="flex flex-col items-center text-center">
                            <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center mb-3 group-hover:bg-yellow-200 transition-colors">
                                <svg class="h-6 w-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Medium</h3>
                            <p class="text-sm text-gray-600 mb-3">Intermediate concepts and moderate complexity</p>
                            <div class="difficulty-stats text-xs text-gray-500">
                                <span class="question-count">Loading...</span> questions
                            </div>
                        </div>
                        <div class="absolute top-2 right-2">
                            <svg class="h-5 w-5 text-yellow-600 opacity-0 peer-checked:opacity-100 transition-opacity" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </label>

                    <!-- Hard Difficulty -->
                    <label class="difficulty-card relative cursor-pointer rounded-lg border-2 border-gray-200 p-6 hover:border-red-300 transition-all duration-200 group">
                        <input type="radio" name="difficulty" value="Hard" class="sr-only peer" required>
                        <div class="flex flex-col items-center text-center">
                            <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mb-3 group-hover:bg-red-200 transition-colors">
                                <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Hard</h3>
                            <p class="text-sm text-gray-600 mb-3">Advanced concepts and challenging problems</p>
                            <div class="difficulty-stats text-xs text-gray-500">
                                <span class="question-count">Loading...</span> questions
                            </div>
                        </div>
                        <div class="absolute top-2 right-2">
                            <svg class="h-5 w-5 text-red-600 opacity-0 peer-checked:opacity-100 transition-opacity" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Form Result (HTMX target) -->
            <div id="form-result" class="mb-6"></div>

            <!-- Debug Panel -->
            <div id="debug-panel" class="mb-6 p-4 bg-gray-100 rounded-lg text-sm">
                <h4 class="font-semibold mb-2">Debug Info:</h4>
                <div>Selected Topic: <span id="debug-topic" class="font-mono bg-white px-2 py-1 rounded">None</span></div>
                <div>Selected Difficulty: <span id="debug-difficulty" class="font-mono bg-white px-2 py-1 rounded">None</span></div>
                <div>Form Ready: <span id="debug-ready" class="font-mono bg-white px-2 py-1 rounded">No</span></div>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-center">
                <button type="submit" class="px-8 py-3 bg-primary-600 text-white font-semibold rounded-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center">
                    <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Start Practice Session
                    <div class="htmx-indicator loading-spinner ml-2"></div>
                </button>
            </div>
        </form>
    </div>

    <!-- Quick Stats Section -->
    <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-white rounded-lg shadow p-6 text-center">
            <div class="text-3xl font-bold text-primary-600" id="total-questions">-</div>
            <div class="text-sm text-gray-600 mt-1">Total Questions</div>
        </div>
        <div class="bg-white rounded-lg shadow p-6 text-center">
            <div class="text-3xl font-bold text-success-600" id="completed-sessions">-</div>
            <div class="text-sm text-gray-600 mt-1">Completed Sessions</div>
        </div>
        <div class="bg-white rounded-lg shadow p-6 text-center">
            <div class="text-3xl font-bold text-warning-600" id="average-score">-</div>
            <div class="text-sm text-gray-600 mt-1">Average Score</div>
        </div>
    </div>

    <!-- Features Section -->
    <div class="mt-12">
        <h2 class="text-2xl font-semibold text-gray-900 text-center mb-8">Why Choose Q&A Practice?</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="text-center">
                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="h-8 w-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Organized by Topic</h3>
                <p class="text-gray-600">Focus on specific subjects to master areas where you need improvement.</p>
            </div>
            <div class="text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="h-8 w-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Progressive Difficulty</h3>
                <p class="text-gray-600">Start with easy questions and work your way up to challenging problems.</p>
            </div>
            <div class="text-center">
                <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="h-8 w-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Instant Feedback</h3>
                <p class="text-gray-600">Get immediate feedback on your answers to learn from mistakes quickly.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Load question statistics when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadStatistics();
    
    // Add change listeners to update question counts dynamically
    const topicInputs = document.querySelectorAll('input[name="topic"]');
    const difficultyInputs = document.querySelectorAll('input[name="difficulty"]');
    
    console.log('Found topic inputs:', topicInputs.length);
    console.log('Found difficulty inputs:', difficultyInputs.length);
    
    topicInputs.forEach((input, index) => {
        console.log(`Adding listener to topic input ${index}:`, input.value);
        input.addEventListener('change', updateQuestionCounts);
        
        // Also add click handler to the parent label for better UX
        const label = input.closest('.topic-card');
        if (label) {
            label.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Topic card clicked:', input.value);
                
                // Remove selected class from all topic cards
                document.querySelectorAll('.topic-card').forEach(card => {
                    card.classList.remove('selected');
                    // Reset inline styles
                    card.style.border = '';
                    card.style.backgroundColor = '';
                });
                
                // Uncheck all topic inputs
                document.querySelectorAll('input[name="topic"]').forEach(inp => {
                    inp.checked = false;
                });
                
                // Add selected class to clicked card and check the input
                input.checked = true;
                label.classList.add('selected');
                
                // Add temporary visual feedback
                label.style.border = '3px solid #3b82f6';
                label.style.backgroundColor = '#eff6ff';
                
                updateQuestionCounts();
                
                // Log success
                console.log('Topic selection successful:', input.value);
            });
        }
    });
    
    difficultyInputs.forEach((input, index) => {
        console.log(`Adding listener to difficulty input ${index}:`, input.value);
        input.addEventListener('change', updateQuestionCounts);
        
        // Also add click handler to the parent label for better UX
        const label = input.closest('.difficulty-card');
        if (label) {
            label.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Difficulty card clicked:', input.value);
                
                // Remove selected class from all difficulty cards
                document.querySelectorAll('.difficulty-card').forEach(card => {
                    card.classList.remove('selected');
                    // Reset inline styles
                    card.style.border = '';
                    card.style.backgroundColor = '';
                });
                
                // Uncheck all difficulty inputs
                document.querySelectorAll('input[name="difficulty"]').forEach(inp => {
                    inp.checked = false;
                });
                
                // Add selected class to clicked card and check the input
                input.checked = true;
                label.classList.add('selected');
                
                // Add temporary visual feedback
                label.style.border = '3px solid #3b82f6';
                label.style.backgroundColor = '#eff6ff';
                
                updateQuestionCounts();
                
                // Log success
                console.log('Difficulty selection successful:', input.value);
            });
        }
    });
    
    // Initial load of question counts
    loadTopicQuestionCounts();
    loadDifficultyQuestionCounts();
    
    // Initially disable the submit button
    const submitButton = document.querySelector('#session-form button[type="submit"]');
    if (submitButton) {
        submitButton.disabled = true;
        console.log('Submit button initially disabled');
    }
});

function loadStatistics() {
    fetch('/api/v1/statistics')
        .then(response => response.json())
        .then(data => {
            document.getElementById('total-questions').textContent = data.total_questions || '0';
            document.getElementById('completed-sessions').textContent = data.completed_sessions || '0';
            document.getElementById('average-score').textContent = (data.average_score || 0) + '%';
            
            // Also update topic and difficulty counts if available
            if (data.questions_by_topic) {
                updateTopicCounts(data.questions_by_topic);
            }
            if (data.questions_by_difficulty) {
                updateDifficultyCounts(data.questions_by_difficulty);
            }
        })
        .catch(error => {
            console.error('Failed to load statistics:', error);
            document.getElementById('total-questions').textContent = '0';
            document.getElementById('completed-sessions').textContent = '0';
            document.getElementById('average-score').textContent = '0%';
        });
}

function updateTopicCounts(topicCounts) {
    const topicCards = document.querySelectorAll('.topic-card');
    topicCards.forEach((card) => {
        const topicName = card.querySelector('h3')?.textContent?.trim();
        const countElement = card.querySelector('.question-count');
        if (countElement && topicName && topicCounts[topicName]) {
            countElement.textContent = topicCounts[topicName];
        }
    });
}

function updateDifficultyCounts(difficultyCounts) {
    const difficultyCards = document.querySelectorAll('.difficulty-card');
    difficultyCards.forEach((card) => {
        const difficultyName = card.querySelector('h3')?.textContent?.trim();
        const countElement = card.querySelector('.question-count');
        if (countElement && difficultyName && difficultyCounts[difficultyName]) {
            countElement.textContent = difficultyCounts[difficultyName];
        }
    });
}

function loadTopicQuestionCounts() {
    // Now handled by loadStatistics() which calls updateTopicCounts()
    // This function is kept for backwards compatibility but delegates to statistics
    console.log('Topic counts loaded via statistics endpoint');
}

function loadDifficultyQuestionCounts() {
    // Now handled by loadStatistics() which calls updateDifficultyCounts()
    // This function is kept for backwards compatibility but delegates to statistics
    console.log('Difficulty counts loaded via statistics endpoint');
}

function updateQuestionCounts() {
    const selectedTopic = document.querySelector('input[name="topic"]:checked');
    const selectedDifficulty = document.querySelector('input[name="difficulty"]:checked');
    
    // Update debug panel
    const debugTopic = document.getElementById('debug-topic');
    const debugDifficulty = document.getElementById('debug-difficulty');
    const debugReady = document.getElementById('debug-ready');
    
    debugTopic.textContent = selectedTopic ? selectedTopic.value : 'None';
    debugDifficulty.textContent = selectedDifficulty ? selectedDifficulty.value : 'None';
    
    if (selectedTopic && selectedDifficulty) {
        // Update form validation state
        const submitButton = document.querySelector('#session-form button[type="submit"]');
        submitButton.disabled = false;
        debugReady.textContent = 'Yes';
        debugReady.className = 'font-mono bg-green-100 text-green-800 px-2 py-1 rounded';
    } else {
        const submitButton = document.querySelector('#session-form button[type="submit"]');
        submitButton.disabled = true;
        debugReady.textContent = 'No';
        debugReady.className = 'font-mono bg-red-100 text-red-800 px-2 py-1 rounded';
    }
}

function createSession(event) {
    event.preventDefault();
    
    const selectedTopic = document.querySelector('input[name="topic"]:checked');
    const selectedDifficulty = document.querySelector('input[name="difficulty"]:checked');
    
    console.log('Form submission attempted:', {
        topic: selectedTopic ? selectedTopic.value : 'none',
        difficulty: selectedDifficulty ? selectedDifficulty.value : 'none'
    });
    
    if (!selectedTopic || !selectedDifficulty) {
        // Update debug panel with error
        const formResult = document.getElementById('form-result');
        formResult.innerHTML = '<div class="p-3 bg-red-100 text-red-700 rounded">Please select both a topic and difficulty level.</div>';
        return false;
    }
    
    // Show success message in debug panel instead of alert
    const formResult = document.getElementById('form-result');
    formResult.innerHTML = `<div class="p-3 bg-green-100 text-green-700 rounded">Ready to create session: ${selectedTopic.value} - ${selectedDifficulty.value}</div>`;
    
    const sessionData = {
        topic: selectedTopic.value,
        difficulty: selectedDifficulty.value,
        total_questions: 5
    };
    
    // Show loading state
    const submitButton = document.querySelector('#session-form button[type="submit"]');
    const originalText = submitButton.innerHTML;
    submitButton.innerHTML = '<div class="loading-spinner mr-2"></div> Creating...';
    submitButton.disabled = true;
    
    // Make API call to create session
    fetch('/api/v1/sessions/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(sessionData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.session_id) {
            // Show success message
            const formResult = document.getElementById('form-result');
            formResult.innerHTML = `
                <div class="p-3 bg-green-100 text-green-700 rounded">
                    <strong>Session Created Successfully!</strong><br>
                    Session ID: ${data.session_id}<br>
                    Redirecting to quiz page...
                </div>
            `;
            
            // Redirect to quiz page after a short delay
            setTimeout(() => {
                window.location.href = `/quiz/${data.session_id}`;
            }, 1500);
        } else {
            throw new Error('No session ID returned');
        }
    })
    .catch(error => {
        console.error('Failed to create session:', error);
        const formResult = document.getElementById('form-result');
        formResult.innerHTML = `
            <div class="p-3 bg-red-100 text-red-700 rounded">
                <strong>Failed to create session:</strong> ${error.message}<br>
                Please try again.
            </div>
        `;
        
        // Reset button
        submitButton.innerHTML = originalText;
        submitButton.disabled = false;
    });
    
    return false;
}

// Handle successful session creation
document.addEventListener('htmx:afterRequest', function(evt) {
    if (evt.detail.target.id === 'form-result' && evt.detail.successful) {
        const response = evt.detail.xhr.response;
        if (response && response.session_id) {
            // Redirect to quiz page
            window.location.href = `/quiz/${response.session_id}`;
        }
    }
});
</script>
{% endblock %}
